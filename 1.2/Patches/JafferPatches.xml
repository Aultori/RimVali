<?xml version="1.0" encoding="utf-8" ?>
<!-- Apply patches to both Jaffers Avali (If you are here, check his out- it's the inspiration for this mod!) and our mod accordingly -->

<Patch>
  <Operation Class="PatchOperationFindMod">
    <mods>
      <li>Avali Race Mod - 1.6.3</li>
    </mods> 
    <match Class="PatchOperationSequence">
      <operations>
        <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/race/body</xpath>
          <value>
             <body>RimValiBody</body>
          </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/raceRestriction/researchList/li/projects/li</xpath>
        <value>
          <li>BasicRimValiTech</li>
          <li>TungstenProcessingBasic</li>
          <li>TungstenProcessingBatch</li>
          <li>TungstenProcessingBatchTwo</li>
          <li>BasicAvaliBionics</li>
          <li>ResearchNanoForge</li>
          <li>ResearchNanoLoom</li>
          <li>AvaliAdvancedMelee</li>
          <li>AvaliAdvancedGuns</li>
          <li>AvaliBasicWeapons</li>
          <li>NanoCarbonResearch</li>
          <li>NanoFibreResearch</li>
          <li>AeroWeaveResearch</li>
          <li>AvaliAeroTungsten</li>
          <li>AvaliFighting</li>
          <li>AdvancedAvaliBionics</li>
          <li>AvaliEliteCooling</li>
          <li>AvaliAdvCooling</li>
          <li>BasicAvaliImplants</li>
        </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="RimVali"]/alienRace/raceRestriction/researchList/li/projects/li</xpath>
        <value>
          <li>AvaliWorkbenches</li>
          <li>AvaliCybernetics</li>
          <li>AvaliBionics</li>
          <li>AvaliClothing</li>
          <li>AvaliClothingAdvanced</li>
          <li>AvaliTurretBasic</li>
          <li>AvaliTurretRapid</li>
          <li>AvaliTurretMissile</li>
          <li>AvaliWeaponsCombat</li>
          <li>AvaliWeaponsHeavy</li>
        </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/raceRestriction/researchList</xpath>
          <value>
            <traitList>
            <li>AvaliFireAfraid</li>
            <li>AvaliRareFireAfraid</li>
            <li>AvaliNormal</li>
            <li>AvaliRare</li>
            <li>AvaliBionicCareless</li>
          </traitList>
          </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/raceRestriction/researchList</xpath>
        <value>
          <weaponList>
            <li>Gun_Avali_Pistol</li>
            <li>Gun_Avali_Pistol</li>
            <li>Gun_Avali_SMG</li>
            <li>Gun_Avali_Rifle</li>
            <li>Gun_Avali_Rifle</li>
            <li>Gun_Avali_Sniper</li>
            <li>Gun_Avali_Minigun</li>
            <li>Gun_Avali_Rocket_Launcher</li>
            <li>Avali_Dagger</li>
            <li>Avali_Sword</li>
            <li>Avali_Spear</li>
          </weaponList>
        </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="RimVali"]/alienRace/raceRestriction/weaponList/li</xpath>
          <value>
            <li>Gun_Avali_Pistol</li>
            <li>Gun_Avali_SMG</li>
            <li>Gun_Avali_Rifle</li>
            <li>Gun_Avali_Rifle</li>
            <li>Gun_Avali_Sniper</li>
            <li>Gun_Avali_Minigun</li>
            <li>Gun_Avali_Rocket_Launcher</li>
            <li>Avali_Dagger</li>
            <li>Avali_Sword</li>
            <li>Avali_Spear</li>
          </value>
        </li>
        <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/alienPartGenerator</xpath>
          <value>
            <notXenophobistTowards>
        <!-- This simply keeps Jaffer's avali from being xenophobic to our avali. If you look in the race def, you'll see the same/similar code is already in our avali.-->
            <li>RimVali</li>
        </notXenophobistTowards>
          </value>
        
        </li>
         <li Class="PatchOperationInsert">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/alienPartGenerator/colorChannels</xpath>
          <value>
            <bodyAddons>
                <li>
                  <drawSize>1</drawSize>
                  <path>avali/Heads/Female/FemaleHead</path>
                  <drawForMale>false</drawForMale>
                  <bodyPart>Head</bodyPart>
                  <inFrontOfBody>true</inFrontOfBody>
                  <layerInvert>false</layerInvert>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.2700965</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.4212219,0.3794212)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.681672)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>                 
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3826366,0.3151125)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                 
                  </offsets>
                  <backstoryGraphics>
                      <NeoStoryAdult>avali/Unique/Neo/Head/NeoHead</NeoStoryAdult>
                      <NeoStoryChild>avali/Unique/Neo/Head/NeoHead</NeoStoryChild>
                      <EimilStoryChild>avali/Unique/Eimilian/Head/EimilHead</EimilStoryChild>
                      <SommeilStoryAdult>avali/Unique/Sommeil/Head/Som</SommeilStoryAdult>
                      <EimilStoryAdult>avali/Unique/Eimilian/Head/EimilHead</EimilStoryAdult>
                      <Danny>avali/Unique/Danny/Head/Danny</Danny>
                    </backstoryGraphics>
                    <hediffGraphics>
                      <AvaliCyberneticHead>avali/Heads/Cybernetic/CyberHead</AvaliCyberneticHead>
                    </hediffGraphics>
                </li>
                                
                <li>
                  <drawSize>1</drawSize>
                  <drawForMale>false</drawForMale>
                  <drawnInBed>false</drawnInBed>
                  <path>avali/Body/Female/FemaleBody</path>
                  <linkVariantIndexWithPrevious>true</linkVariantIndexWithPrevious>
                  <layerInvert>false</layerInvert>
                  <bodyPart>Torso</bodyPart>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.3086816</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.42,0.3765274)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6881029)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3954984,0.3151126)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                  <backstoryGraphics>
                    <NeoStoryAdult>avali/Unique/Neo/Body/NeoBody</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/Body/NeoBody</NeoStoryChild>
                    <EimilStoryChild>avali/Unique/Eimilian/Body/Eimil_body</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/Body/Eimil_body</EimilStoryAdult>
                    <SommeilStoryAdult>avali/Unique/Sommeil/Body/Som</SommeilStoryAdult>
                    <Danny>avali/Unique/Danny/Body/Danny</Danny>
                  </backstoryGraphics>
                </li>
                
                <li>
                  <drawnInBed>false</drawnInBed>
                  <drawSize>1</drawSize>
                  <drawForMale>false</drawForMale>
                  <layerInvert>true</layerInvert>
                  <angle>-3</angle>
                  <inFrontOfBody>false</inFrontOfBody>
                  <path>avali/Tail/Female/FemaleTail</path>
                  <linkVariantIndexWithPrevious>true</linkVariantIndexWithPrevious>
                  <bodyPart>RimValiTail</bodyPart>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.2700965</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.4469453,0.3536978)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6945338)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.4308682,0.2797428)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                  <backstoryGraphics>
                    <EimilStoryChild>avali/Unique/Eimilian/Tail/EimilTail</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/Tail/EimilTail</EimilStoryAdult>
                    <NeoStoryAdult>avali/Unique/Neo/Tail/NeoTail</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/Tail/NeoTail</NeoStoryChild>
                    <SommeilStoryAdult>avali/Unique/Sommeil/Tail/Som</SommeilStoryAdult>
                    <Danny>avali/Unique/Danny/Tail/Danny</Danny>
                  </backstoryGraphics>
                </li>
                
                <li>
                  <drawSize>1</drawSize>
                  <path>avali/Heads/Male/MaleHead</path>
                  <drawForFemale>false</drawForFemale>
                  <bodyPart>Head</bodyPart>
                  <inFrontOfBody>true</inFrontOfBody>
                  <layerInvert>false</layerInvert>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.2700965</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.4212219,0.3794212)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.681672)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>                 
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3826366,0.3151125)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                 
                  </offsets>
                  <backstoryGraphics>
                      <NeoStoryAdult>avali/Unique/Neo/Head/NeoHead</NeoStoryAdult>
                      <NeoStoryChild>avali/Unique/Neo/Head/NeoHead</NeoStoryChild>
                      <EimilStoryChild>avali/Unique/Eimilian/Head/EimilHead</EimilStoryChild>
                      <SommeilStoryAdult>avali/Unique/Sommeil/Head/Som</SommeilStoryAdult>
                      <EimilStoryAdult>avali/Unique/Eimilian/Head/EimilHead</EimilStoryAdult>
                      <Danny>avali/Unique/Danny/Head/Danny</Danny>
                    </backstoryGraphics>
                    <hediffGraphics>
                      <AvaliCyberneticHead>avali/Heads/Cybernetic/CyberHead</AvaliCyberneticHead>
                    </hediffGraphics>
                </li>
                
                <li>
                  <drawSize>1</drawSize>
                  <drawForFemale>false</drawForFemale>
                  <path>avali/Body/Male/MaleBody</path>
                  <drawnInBed>false</drawnInBed>
                  <layerInvert>false</layerInvert>
                  <linkVariantIndexWithPrevious>true</linkVariantIndexWithPrevious>
                  <bodyPart>Torso</bodyPart>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.3086816</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.42,0.3765274)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6881029)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3954984,0.3151126)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                  <backstoryGraphics>
                    <NeoStoryAdult>avali/Unique/Neo/Body/NeoBody</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/Body/NeoBody</NeoStoryChild>
                    <EimilStoryChild>avali/Unique/Eimilian/Body/Eimil_body</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/Body/Eimil_body</EimilStoryAdult>
                    <SommeilStoryAdult>avali/Unique/Sommeil/Body/Som</SommeilStoryAdult>
                    <Danny>avali/Unique/Danny/Body/Danny</Danny>
                  </backstoryGraphics>
                </li>
                
                <li>
                  <drawSize>1</drawSize>
                  <drawForFemale>false</drawForFemale>
                  <path>avali/Tail/Male/MaleTail</path>
                  <drawnInBed>false</drawnInBed>
                  <inFrontOfBody>false</inFrontOfBody>
                  <layerInvert>true</layerInvert>
                  <linkVariantIndexWithPrevious>true</linkVariantIndexWithPrevious>
                  <bodyPart>RimValiTail</bodyPart>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.2291833</layerOffset>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.4083601,0.3536978)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6945338)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.4051447,0.2797428)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                  <backstoryGraphics>
                    <EimilStoryChild>avali/Unique/Eimilian/Tail/EimilTail</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/Tail/EimilTail</EimilStoryAdult>
                    <NeoStoryAdult>avali/Unique/Neo/Tail/NeoTail</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/Tail/NeoTail</NeoStoryChild>
                    <SommeilStoryAdult>avali/Unique/Sommeil/Tail/Som</SommeilStoryAdult>
                    <Danny>avali/Unique/Danny/Tail/Danny</Danny>
                  </backstoryGraphics>
                </li>
                
                <li>
                  <drawnInBed>false</drawnInBed>
                  <drawSize>1</drawSize>
                  <bodyPart>RimValiTail</bodyPart>
                  <inFrontOfBody>false</inFrontOfBody>
                  <layerInvert>false</layerInvert>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.3096463</layerOffset>
                  <drawForFemale>false</drawForFemale>
                  <path>avali/Tail/Tailskirt/Male/MaleTailskirt</path>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(0,0)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6752412)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3954984,0.311897)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                  <backstoryGraphics>
                    <EimilStoryChild>avali/Unique/Eimilian/tailskirt/Emil</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/tailskirt/Emil</EimilStoryAdult>
                    <NeoStoryAdult>avali/Unique/Neo/tailskirt/Neo</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/tailskirt/Neo</NeoStoryChild>
                    <SommeilStoryAdult>avali/Unique/Sommeil/tailskirt/Som</SommeilStoryAdult>
                    <Danny>avali/Unique/Danny/Tailskirt/Danny</Danny>
                  </backstoryGraphics>
                </li>
                <li>
                  <drawSize>1</drawSize>
                  <drawnInBed>false</drawnInBed>
                  <bodyPart>RimValiTail</bodyPart>
                  <inFrontOfBody>false</inFrontOfBody>
                  <layerInvert>false</layerInvert>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.3096463</layerOffset>
                  <drawForMale>false</drawForMale>
                  <path>avali/Tail/Tailskirt/Female/FemaleTailskirt</path>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(0,0)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.6752412)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3954984,0.311897)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>
                  </offsets>
                </li>
                <li>
                  <drawSize>1</drawSize>
                  <inFrontOfBody>false</inFrontOfBody>
                  <layerInvert>false</layerInvert>
                  <colorChannel>skin</colorChannel>
                  <layerOffset>-0.4575563</layerOffset>
                  <path>avali/Heads/AvaliHead</path>
                  <offsets>
                    <south>
                      <bodyTypes>
                        <Avali>(-0.4212219,0.3794212)</Avali>
                      </bodyTypes>
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </south>
                    <north>
                      <bodyTypes>
                        <Avali>(0,0.681672)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>                 
                    </north>
                    <east>
                      <bodyTypes>
                        <Avali>(-0.3826366,0.3151125)</Avali>
                      </bodyTypes> 
                      <crownTypes>
                        <AvaliHead>(0,0)</AvaliHead>
                      </crownTypes>
                    </east>                  
                  </offsets>
                  <backstoryGraphics>
                    <EimilStoryChild>avali/Unique/Eimilian/headfeather/Emil</EimilStoryChild>
                    <EimilStoryAdult>avali/Unique/Eimilian/headfeather/Emil</EimilStoryAdult>
                    <NeoStoryAdult>avali/Unique/Neo/headfeathers/Neo</NeoStoryAdult>
                    <NeoStoryChild>avali/Unique/Neo/headfeathers/Neo</NeoStoryChild>
                  </backstoryGraphics>
                  <hiddenUnderApparelFor>
                    <li>UpperHead</li>
                    <li>FullHead</li>
                  </hiddenUnderApparelFor>
                </li>
              </bodyAddons>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/alienPartGenerator/aliencrowntypes</xpath>
          <value>
            <aliencrowntypes>
						<li>AvaliHead</li>
					</aliencrowntypes>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/alienPartGenerator/alienbodytypes</xpath>
          <value>
          <alienbodytypes>
						  <li>Avali</li>
            </alienbodytypes>
          </value>
        </li>
                <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/graphicPaths</xpath>
          <value>
            <graphicPaths>
                <li>
                    <head>avali/Heads/</head>
                    <body>avali/Body/</body>
                </li>
            </graphicPaths>
          </value>
        </li>
        <li Class="PatchOperationAdd">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/alienPartGenerator</xpath>
          <value>
            <useGenderedBodies>false</useGenderedBodies>
					  <useGenderedHeads>false</useGenderedHeads>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/hairSettings</xpath>
          <value>
            <hairSettings>
                <hasHair>false</hasHair>
            </hairSettings>
          </value>
        </li>
        <li Class="PatchOperationReplace">
          <xpath>/Defs/AlienRace.ThingDef_AlienRace[defName="Alien_Avali"]/alienRace/generalSettings/disallowedTraits</xpath>
          <value>
            <disallowedTraits>
                <li>
                    <defName>Transhumanist</defName>
                </li>
                <li>
                  <defName>BodyPurist</defName>
                </li>
                <li>
                  <defName>Greedy</defName>
                </li>
                <li>
                  <defName>Jealous</defName>
                </li>
              </disallowedTraits>
          </value>
        </li>
        
      </operations>
    </match>
  </Operation>
</Patch>